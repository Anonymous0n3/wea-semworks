@model List<WebApplication1.Models.HelloDoc>

<div class="container mt-4">

    <!-- Jazykový přepínač -->
    <div class="d-flex justify-content-end mb-3">
        <select id="langSelect" class="form-select form-select-sm w-auto">
            <option value="cs">Čeština</option>
            <option value="en">English</option>
        </select>
    </div>

    <hr class="my-4" />

    <!-- 🔽 Kontejner pro widgety -->
    <div id="widgetContainer" class="mb-4">
        <!-- sem se dynamicky načte AppInfoWidget nebo jiné -->
    </div>


@{
    ViewData["Title"] = "Dashboard";
}

<div class="container mt-4">

    <!-- Původní Hello CouchDB sekce -->
    <h2>Hello CouchDB</h2>

    @if (Model != null && Model.Any())
    {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Text</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var doc in Model)
                {
                    <tr>
                        <td>@doc.text</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p><strong>Databáze je prázdná</strong></p>
    }

    <form asp-controller="Hello" asp-action="Save" method="post" class="mt-3">
        <div class="form-group">
            <label for="text">Zadej nový text:</label>
            <input type="text" class="form-control" id="text" name="text" />
        </div>
        <button type="submit" class="btn btn-primary mt-2">Uložit</button>
    </form>
</div>


    @section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const widgetLinks = document.querySelectorAll('.widget-link');
                const container = document.getElementById('widgetContainer');

                widgetLinks.forEach(link => {
                    link.addEventListener('click', async (e) => {
                        e.preventDefault();
                        const widgetName = link.getAttribute('data-widget');

                        try {
                            const response = await fetch(`/Widget/Load?name=${widgetName}`);
                            const html = await response.text();
                            container.innerHTML = html;
                        } catch (err) {
                            container.innerHTML = "<div class='alert alert-danger'>Nepodařilo se načíst widget.</div>";
                        }
                    });
                });

                // 🔄 Jazykový přepínač
                const langSelect = document.getElementById('langSelect');
                const savedLang = localStorage.getItem('lang');
                const browserLang = navigator.language.startsWith('en') ? 'en' : 'cs';
                langSelect.value = savedLang || browserLang;

                langSelect.addEventListener('change', () => {
                    localStorage.setItem('lang', langSelect.value);
                    location.reload();
                });
            });
        </script>
    }
