@model IReadOnlyList<string>

@{
    var baseCurrency = ViewData["BaseCurrency"] as string ?? "EUR";
    var quoteCurrency = ViewData["QuoteCurrency"] as string ?? "USD";
    var rate = (decimal)(ViewData["Rate"] ?? 0m);
    var volatility = (decimal)(ViewData["Volatility"] ?? 0m);
    var history = ViewData["History"] as List<(DateTime Date, decimal Rate)> ?? new();
}

<div class="currency-widget card shadow-sm p-4 rounded-3 bg-light">
    <h3 class="mb-3 text-center">
        Kurz: @baseCurrency → @quoteCurrency
    </h3>

    <div class="current-rate text-center mb-4">
        <h4>Aktuální kurz</h4>
        <p class="fs-3 fw-bold text-primary">@rate</p>
        <small class="text-muted">
            Volatilita za poslední 3 dny: <strong>@volatility&nbsp;%</strong>
        </small>
    </div>

    <hr />

    <div class="history mt-3">
        <h5>Historie za poslední 3 dny</h5>
        <table class="table table-striped table-sm mt-2">
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Kurz</th>
                    <th>Změna oproti aktuálnímu</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var point in history.OrderByDescending(h => h.Date))
                {
                    var diffPercent = point.Rate == 0 ? 0 : (rate - point.Rate) / point.Rate * 100m;
                    var diffClass = diffPercent >= 0 ? "text-success" : "text-danger";
                    <tr>
                        <td>@point.Date.ToString("dd.MM.yyyy")</td>
                        <td>@point.Rate</td>
                        <td class="@diffClass">
                            @(diffPercent >= 0 ? "+" : "")@Math.Round(diffPercent, 2) %
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <hr />

    <div class="text-center mt-4">
        <form id="currencyForm" class="d-inline-block">
            <label for="baseCurrency" class="form-label me-2">Základní měna:</label>
            <select id="baseCurrency" name="baseCurrency" class="form-select d-inline-block w-auto me-3">
                @foreach (var c in Model)
                {
                    if (c == ViewBag.BaseCurrency)
                    {
                        <option value="@c" selected>@c</option>
                    }
                    else
                    {
                        <option value="@c">@c</option>
                    }
                }
            </select>

            <label for="quoteCurrency" class="form-label me-2">Cílová měna:</label>
            <select id="quoteCurrency" name="quoteCurrency" class="form-select d-inline-block w-auto me-3">
                @foreach (var c in Model)
                {
                    if (c == ViewBag.QuoteCurrency)
                    {
                        <option value="@c" selected>@c</option>
                    }
                    else
                    {
                        <option value="@c">@c</option>
                    }
                }
            </select>

            <button type="submit" class="btn btn-primary">Zobrazit aktuální kurz</button>
        </form>


    </div>
</div>

<style>
    .currency-widget {
        max-width: 650px;
        margin: 0 auto;
    }
</style>
